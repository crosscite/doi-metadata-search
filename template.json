{
  "builders": [
    {
      "type": "amazon-ebs",
      "access_key": "{{user `access_key`}}",
      "secret_key": "{{user `secret_key`}}",
      "region": "{{user `region`}}",
      "source_ami": "{{user `source_ami`}}",
      "instance_type": "{{user `instance_type`}}",
      "ssh_username": "ubuntu",
      "ami_name": "doi-metadata-search {{timestamp}}"
    }
  ],
  "provisioners": [
    {
      "type": "chef-solo",
      "cookbook_paths": ["vendor/cookbooks"],
      "run_list": ["recipe[doi_metadata_search]"],
      "json": {
        "ruby": {
          "deploy_user": "ubuntu",
          "deploy_group": "ubuntu",
          "rails_env": "production"
        },
        "phantomjs": {
          "version": "1.9.7",
          "base_url": "https://bitbucket.org/ariya/phantomjs/downloads" }
      }
    }
  ],
  "post-processors": [
    {
      "type": "atlas",
      "artifact": "datacite/doi-metadata-search",
      "artifact_type": "amazon.ami",
      "token": "{{user `atlas_token`}}",
      "metadata": {
        "created_at": "{{timestamp}}"
      }
    }
  ],
  "variables": {
    "compression_level": "6",
    "cpus": "2",
    "disk_size": "40000",
    "headless": "false",
    "memory": "2048",
    "mirror": "http://releases.ubuntu.com",
    "access_key": "{{env `AWS_ACCESS_KEY_ID`}}",
    "secret_key": "{{env `AWS_SECRET_ACCESS_KEY`}}",
    "region": "{{env `AWS_REGION`}}",
    "source_ami": "{{env `AWS_SOURCE_AMI`}}",
    "instance_type": "{{env `AWS_INSTANCE_TYPE`}}",
    "atlas_token": "{{env `ATLAS_TOKEN`}}"
  },
   "push": {
    "name": "datacite/doi-metadata-search",
    "vcs": true
  }
}
