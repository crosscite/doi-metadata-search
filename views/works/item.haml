- attributes = item.fetch("attributes", {})
- includes = @works.present? ? @works[:included] : @work[:included]
- work_types = includes.select { |item| item["type"] == "work-types" }
- sources = @works.present? ? @works[:meta].fetch("sources", []) : []
- new_params = params[:model] == "works" && params["id"].present? ? params.merge(external_link: true) : params

%script{type: "application/ld+json"}
  = work_as_json_ld(id: item["id"], attributes: attributes)

.panel.panel-default
  .panel-body
    %h3.work
      %a{:href => works_action(item, new_params)}
        = attributes["title"]
    - if attributes["author"].present?
      = author_format(attributes["author"])
    .metadata
      = metadata_format(attributes, work_types: work_types)
    - if attributes["description"].present?
      .description
        = description_format(attributes["description"])
    - if attributes["license"].present?
      .license
        %a{:href => attributes["license"]}
          %img{:src => license_img(attributes["license"])}

  - if attributes["results"].present?
    - attributes["results"].each do |s|
      .panel-footer
        = s.fetch("title", nil)
        %span.badge
          = number_with_delimiter(s.fetch("count", 0))

  .panel-footer.item-links
    %a{:href => item["id"]}
      %i.fa.fa-external-link
      = item["id"]
    - if attributes["doi"].present?
      %a.cite-link.nowrap{:href => "javascript:showCiteBox('#{attributes["doi"]}', '#{attributes["title"]}');"}
        %i.fa.fa-quote-left
        Cite

    - if user_signed_in? && attributes["registration-agency-id"] == "datacite"
      = haml :'works/claim', locals: { item: item }
