= haml :"#{ENV['RA']}/header", locals: { page: {} }

.container-fluid
  .row
    .col-md-9#content-work
      = haml :'works/item', locals: { item: @work }

    .col-md-3
      - registration_agency_id = @work.fetch("attributes", {}).fetch("registration-agency-id", nil)
      - publisher_id = @work.fetch("attributes", {}).fetch("publisher-id", nil)
      - member_id = @work.fetch("attributes", {}).fetch("member-id", nil)
      .panel.facets
        .panel-body.metadata
          - if registration_agency_id == "datacite"
            %h5
              Data Center
            .data-center
              %a{href: "/data-centers/#{publisher_id}"}
                = publisher_title(@publishers, publisher_id)
          - elsif publisher_id.present?
            %h5
              Publisher
            .data-center
              %a{href: "/data-centers/#{publisher_id}"}
                = publisher_title(@publishers, publisher_id)
          - if registration_agency_id == "datacite"
            %h5
              Member
            .registration_agency
              %a{href: "/members/#{member_id}"}
                = member_title(@members, member_id)
          - elsif registration_agency_id.present?
            %h5
              Registration Agency
            .registration_agency
              = registration_agency_format(@work.fetch("attributes", {}))

      .panel.tags
        .panel-body
          .bottom-teaser.cf
            .isLeft
              %h5.index-headline.featured
                %span
                  Share on
              - settings.social.each do |social|
                - href = social['share_url'] + social['share_title'] + @work.fetch("attributes", {}).fetch("title", "") + social['share_link'] + @work.fetch("id")
                %a{href: href, class: "icon-#{social['icon']}", onclick: "window.open(this.href, '#{social['icon']}-share', 'width=550,height=255');return false;"}
                  %i.fa{class: "fa-#{social['icon']} fa-2x"}
                  %span.hidden
                    = social['icon']

  - if @relations.length > 0 || @contributions.length > 0
    %ul.nav.nav-pills
      - if @relations.length > 0
        %li.active
          %a{href: "#relations", data: { toggle: "tab" } }
            Relations
            - if @relations.length > 0
              %span.badge
                = number_with_delimiter(@meta['relation-total'])
      - if @contributions.length > 0
        - if @relations.length > 0
          %li
            %a{href: "#contributions", data: { toggle: "tab" } }
              Contributions
              %span.badge
                = number_with_delimiter(@meta['contribution-total'])
        - else
          %li.active
            %a{href: "#contributions", data: { toggle: "tab" } }
              Contributions
              %span.badge
                = number_with_delimiter(@meta['contribution-total'])

    .tab-content
      - if @relations.length > 0
        .tab-pane.active#relations
          .row
            .col-md-9#content-relations
              = haml :'relations/index'

            .col-md-3
              = haml :'relations/facets'

      - if @contributions.length > 0
        - if @relations.length > 0
          .tab-pane#contributions
            .row
              .col-md-9#content-contributions
                = haml :'contributions/index'

              .col-md-3
                = haml :'contributions/facets'
        - else
          .tab-pane.active#contributions
            .row
              .col-md-9#content-contributions
                = haml :'contributions/index'

              .col-md-3
                = haml :'contributions/facets'

= haml :cite_box

%script{:type => 'text/javascript', :src => '/javascripts/itemlist.js'}

= haml :"#{ENV['RA']}/footer"
