= haml :"#{ENV['RA']}/header", locals: { page: {} }

- data_center = @work[:included].find { |i| i.fetch("type", nil) == "data-centers" }
- member = @work[:included].find { |i| i.fetch("type", nil) == "members" }
- registration_agency = @work[:included].find { |i| i.fetch("type", nil) == "registration-agencies" }

.container-fluid
  .content
    .row
      .col-md-9#content-work
        - if @work[:data].present?
          = haml :'works/item', locals: { item: @work[:data] }
        - elsif @work[:errors].present?
          %div.alert.alert-warning
            = @work[:errors].first.fetch("title", "")

      - if @work[:data].present?
        .col-md-3
          .panel.facets
            .panel-body.metadata
              - if registration_agency && registration_agency.fetch("id", nil) == "datacite" && data_center.present?
                %h5
                  Data Center
                .data-center
                  %a{href: "/data-centers/#{data_center.fetch('id')}"}
                    = data_center.fetch("attributes", {}).fetch("title", nil)
              - elsif data_center.present?
                %h5
                  Publisher
                .data-center
                  %a{href: "/data-centers/#{data_center.fetch('id')}"}
                    = data_center.fetch("attributes", {}).fetch("title", nil)
              - if registration_agency && registration_agency.fetch("id", nil) == "datacite" && member.present?
                %h5
                  Member
                .registration_agency
                  %a{href: "/members/#{member.fetch('id')}"}
                    = member.fetch("attributes", {}).fetch("title", nil)
              - elsif registration_agency.present?
                %h5
                  Registration Agency
                .registration_agency
                  = registration_agency.fetch("attributes", {}).fetch("title", nil)

          .panel.tags
            .panel-body
              .bottom-teaser.cf
                .isLeft
                  %h5
                    %span
                      Share on
                  - settings.social.each do |social|
                    - href = social['share_url'] + social['share_title'] + (@work.fetch("attributes", {}).fetch("title", nil)).to_s + social['share_link'] + @work.fetch("id", "")
                    %a{href: href, class: "icon-#{social['icon']} share", onclick: "window.open(this.href, '#{social['icon']}-share', 'width=550,height=255');return false;"}
                      %i.fa{class: "fa-#{social['icon']}"}
                      %span.hidden
                        = social['icon']

      - if @works[:data].length > 0
        / - if @works[:data].length > 1
        /   .col-md-9
        /     = haml :'works/search'

        .col-md-9.panel-list#content-works
          %h3.results
            = pluralize(number_with_delimiter(@works[:meta]['total']), "Related Work")
          - @works[:data].each do |item|
            = haml :'works/item', locals: { item: item }

          .text-center
            = will_paginate @works[:data], renderer: BootstrapPagination::Sinatra, inner_window: 1

        .col-md-3
          = haml :'works/facets'

= haml :cite_box

= haml :"#{ENV['RA']}/footer"
